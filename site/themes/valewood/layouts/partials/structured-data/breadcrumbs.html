{{- $sp := newScratch -}}
{{- $url := replace .Page.Permalink (printf "%s" .Site.BaseURL) ""}}
{{- $sp.Add "path" .Site.BaseURL -}}
{{- $sp.Add "breadcrumb" (slice (dict "url" .Site.BaseURL "name" "Home"))}}
{{- $sp.Add "permalink" .Page.Permalink -}}
{{- $sp.Add "title" .Page.Title -}}
{{- $pScratch := $sp -}}

{{- range $index, $element := split $url "/" -}}
  {{- $pScratch.Add "path" $element -}}
  {{- $pScratch.Add "path" "/" -}}
  {{- if ne $element "" -}}
    {{- if eq ($pScratch.Get "path") ($pScratch.Get "permalink") -}}
        {{- $pScratch.Add "breadcrumb" (slice (dict "url" ($pScratch.Get "path") "name" ($pScratch.Get "title")))}}
    {{- else -}}
        {{- $pScratch.Add "breadcrumb" (slice (dict "url" ($pScratch.Get "path") "name" (humanize .)))}}
    {{- end -}}
  {{- end -}}
{{- end -}}

    <script type="application/ld+json">
    {
        "@context":"https:\/\/schema.org\/",
        "@type":"BreadcrumbList",
        "itemListElement":[
            {{- range $index, $breadcrumb := $sp.Get "breadcrumb" -}}
            {{- if ne $index 0 -}},{{- end -}}
            {
                "@type": "ListItem",
                "position": {{- add $index 1 -}},
                "item": {
                    "@id": {{- printf "%s" $breadcrumb.url -}},
                    "name": "{{- $breadcrumb.name -}}"
                }
                
            }
        {{- end -}}
        ]
    }
    </script>